\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{geometry}
\usepackage{bm}
\usepackage{xcolor}
\usepackage{hyperref}
\geometry{a4paper, margin=1in}

\title{Mathematical Foundations of the Buera \& Shin (2013) \\ Spectral Time Iteration Implementation}
\author{Piero De Dominicis \\ Bocconi University}
\date{\today}

\begin{document}

\maketitle

\section{The Economic Environment}
The economy is populated by a continuum of agents who choose to be either workers or entrepreneurs. Agents are heterogeneous in their asset holdings $a$ and entrepreneurial ability $z$.

\subsection{Preferences and Shocks}
Agents maximize expected lifetime utility:
\begin{equation}
    \mathbb{E}_0 \sum_{t=0}^{\infty} \beta^t \frac{c_t^{1-\sigma}-1}{1-\sigma}
\end{equation}
Entrepreneurial ability $z$ follows a reset process: with probability $\psi$, $z_{t+1} = z_t$; with probability $1-\psi$, a new ability is drawn $z' \sim \pi(z)$ from a Pareto distribution with tail parameter $\eta$. In the pre-reform state, agents also face idiosyncratic output wedges $\tau \in \{\tau^+, \tau^-\}$, where $\mathbb{P}(\tau = \tau^+ | z) = 1 - e^{-q z}$.

\section{Production and Optimal Firm Decisions}
An entrepreneur with ability $z$ and assets $a$ operates the technology:
\begin{equation} 
    y = z (k^\alpha l^{1-\alpha})^{1-\nu}
\end{equation}
where $\nu$ represents the span-of-control parameter (entrepreneur's share). The entrepreneur faces a collateral constraint $k \leq \lambda a$.

\subsection{Static Profit Maximization}
The entrepreneur's problem is solved in two stages. First, given capital $k$, the optimal labor $l^*(k, z)$ is found by solving:
\begin{equation}
    \max_l \{ z (k^\alpha l^{1-\alpha})^{1-\nu} - w l - (r+\delta) k \}
\end{equation}
The first-order condition with respect to $l$ is:
\begin{equation}
    (1-\nu)(1-\alpha) z k^{\alpha(1-\nu)} l^{(1-\alpha)(1-\nu)-1} = w
\end{equation}
Solving for $l$ yields the conditional labor demand:
\begin{equation}
    l^*(k, z) = \left[ \frac{(1-\nu)(1-\alpha) z}{w} \right]^{\frac{1}{1-(1-\alpha)(1-\nu)}} k^{\frac{\alpha(1-\nu)}{1-(1-\alpha)(1-\nu)}}
\end{equation}
Substituting $l^*(k, z)$ back into the profit function gives a profit function $\pi(k)$ that is concave in $k$. The unconstrained capital demand $k^{unc}$ satisfies $\pi'(k^{unc}) = r+\delta$. If $k^{unc} > \lambda a$, the entrepreneur is borrowing-constrained and sets $k^* = \lambda a$.

\section{The Recursive Household Problem}
The agent's state is $(a, z)$. The total income is $y(a, z) = \max\{\pi(a, z, k^*), w\} + (1+r)a$. The Bellman equation is:
\begin{equation}
    V(a, z) = \max_{a'} \left\{ \frac{(y(a, z) - a')^{1-\sigma}-1}{1-\sigma} + \beta \text{Cont}(a', z) \right\}
\end{equation}
where the continuation value is:
\begin{equation}
    \text{Cont}(a', z) = \psi V(a', z) + (1-\psi) \int V(a', z') \pi(z') dz'
\end{equation}

\subsection{Derivation of the Euler Equation and KKT Conditions}
To solve the household's problem under the borrowing constraint $a_{t+1} \geq a_{min}$, we form the Lagrangian:
\begin{equation}
    \mathcal{L} = \mathbb{E}_0 \sum_{t=0}^{\infty} \beta^t \left[ \frac{c_t^{1-\sigma}-1}{1-\sigma} + \mu_t (a_{t+1} - a_{min}) \right]
\end{equation}
Substituting $c_t = y(a_t, z_t) - a_{t+1}$, the first-order condition with respect to $a_{t+1}$ is:
\begin{equation}
    -c_t^{-\sigma} + \beta \mathbb{E}_t [ (1+r) c_{t+1}^{-\sigma} ] + \mu_t = 0 \implies c_t^{-\sigma} = \beta (1+r) \mathbb{E}_t [ c_{t+1}^{-\sigma} ] + \mu_t
\end{equation}
The Lagrange multiplier $\mu_t$ must satisfy the Karush-Kuhn-Tucker (KKT) complementarity conditions:
\begin{equation}
    \mu_t \geq 0, \quad a_{t+1} \geq a_{min}, \quad \mu_t (a_{t+1} - a_{min}) = 0
\end{equation}
When the agent is unconstrained ($\mu_t = 0$), the standard Euler equation holds. When the constraint binds ($a_{t+1} = a_{min}$), we have $\mu_t > 0$, implying $c_t^{-\sigma} > \beta (1+r) \mathbb{E}_t [c_{t+1}^{-\sigma}]$.

\section{Spectral Discretization and Setup}
The policy function $a'(a, z)$ is approximated by a bivariate Chebyshev polynomial $\hat{a}(a, z; \bm{\gamma})$.

\subsection{Chebyshev Collocation Nodes}
The state space is discretized using the zeros of the $N$-th degree Chebyshev polynomial $\xi \in [-1, 1]$:
\begin{equation}
    \xi_k = \cos \left( \frac{2k - 1}{2N} \pi \right), \quad k \in \{1, \dots, N\}
\end{equation}
The nodes are mapped to the physical state space $(a, z)$. For assets, we use a log-linear mapping to cluster nodes near the borrowing constraint:
\begin{equation}
    a_k = \exp\left( \frac{\ln(a_{max} + \text{shift}) + \ln(a_{min} + \text{shift})}{2} + \xi_k \frac{\ln(a_{max} + \text{shift}) - \ln(a_{min} + \text{shift})}{2} \right) - \text{shift}
\end{equation}
while ability nodes $z_j$ are mapped linearly.

\section{Spectral Time Iteration Logic}
\subsection{Pointwise Euler Inversion}
To solve for the optimal policy, we utilize a recursive operator that linearizes the Global Euler Equation. At each collocation node $(a_i, z_j)$, we define the \textbf{Target Function} $F(a')$ as the difference between current marginal utility and expected future marginal utility:
\begin{equation}
    F(a'; a_i, z_j, \bm{\gamma}^{(n)}) \equiv \underbrace{(y_i - a')^{-\sigma}}_{\text{Current MU}} - \beta(1+r) \underbrace{\mathcal{E}(a'; \bm{\gamma}^{(n)})}_{\text{Continuation MU}}
\end{equation}
where $\mathcal{E}$ is the expectation over future states $(\hat{a}_i, z')$ given the \textbf{known} continuation policy $\bm{\gamma}^{(n)}$:
\begin{equation}
    \mathcal{E}(a'; \bm{\gamma}^{(n)}) = \psi \left( y(a', z_j) - \bm{\Phi}(a', z_j)^\top \bm{\gamma}^{(n)} \right)^{-\sigma} + (1-\psi) \sum_k \pi_k \left( y(a', z_k) - \bm{\Phi}(a', z_k)^\top \bm{\gamma}^{(n)} \right)^{-\sigma}
\end{equation}
Since $\mathcal{E}$ is fixed for a given guess of $a'$, we can identify the optimal $a^*_{target}$ by direct inversion. The solver handles the KKT conditions robustly by applying the non-negativity constraint after the unconstrained inversion:
\begin{equation}
    a^*_{target, i} = \max\{a_{min}, y_i - \left[ \beta(1+r) \mathcal{E}(a'; \bm{\gamma}^{(n)}) \right]^{-1/\sigma} \}
\end{equation}
This "max" operator ensures that when the implied savings would fall below $a_{min}$, the agent is snapped to the constraint, implicitly satisfying $\mu_t > 0$.
This formulation depends exclusively on the grid points $(a_i, z_j)$ and the candidate savings $a'$, with the future behavior already "baked" into the coefficients $\bm{\gamma}^{(n)}$.

\subsection{Damped Coefficient Update}
The algorithm computes the new policy nodes $\bm{A}^*_{new}$ by applying a damping parameter $\theta \in (0, 1]$ to ensure numerical stability:
\begin{equation}
    \bm{A}^{*}_{new} = (1-\theta) \bm{A}^{*}_{old} + \theta \bm{A}^*_{target}
\end{equation}
The updated spectral coefficients $\bm{\gamma}^{(n+1)}$ are then obtained by solving the linear basis transformation:
\begin{equation}
    \bm{\gamma}^{(n+1)} = \bm{T}^{-1} \bm{A}^{*}_{new}
\end{equation}
where $\bm{T}$ is the matrix of Chebyshev basis functions evaluated at the collocation nodes.




\section{Distributional and Transition Dynamics}
The distribution is tracked on a dense grid using a Markov transition matrix $Q$ derived from the continuous policy $\hat{a}$.
\begin{equation}
    \mu_{t+1}(a', z') = \sum_{a, z} \mathbb{P}(a' | a, z) \mathbb{P}(z' | z) \mu_t(a, z)
\end{equation}
Aggregate labor $L_t$ and capital $K_t$ are then calculated by summing firm decisions over the distribution $\mu_t$.

\section{Convergence and General Equilibrium}
The general equilibrium wage $w$ and interest rate $r$ are found by iterating on the price paths using Algorithm B.2. The spectral methodâ€™s continuity ensures that the excess demand functions $ED_L(w, r)$ and $ED_K(w, r)$ are smooth, allowing for robust bisection even with a relatively small number of spectral nodes.

\end{document}
